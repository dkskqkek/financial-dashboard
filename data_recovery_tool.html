<!DOCTYPE html>
<html>
<head>
    <title>ğŸ“Š Financial Dashboard - ë°ì´í„° ë³µêµ¬ ë„êµ¬</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f8f9fa; }
        .container { max-width: 1000px; margin: 0 auto; }
        .recovery-section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .button { padding: 12px 20px; margin: 8px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .button:hover { background: #0056b3; }
        .danger { background: #dc3545; }
        .danger:hover { background: #c82333; }
        .success { background: #28a745; }
        .success:hover { background: #218838; }
        .result { background: #e9f7ef; padding: 15px; border-radius: 5px; margin: 15px 0; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; padding: 15px; border-radius: 5px; margin: 15px 0; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; padding: 15px; border-radius: 5px; margin: 15px 0; border-left: 4px solid #17a2b8; }
        .code-block { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: monospace; font-size: 12px; border: 1px solid #e9ecef; }
        pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }
        .recovery-steps { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 15px 0; border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Financial Dashboard - ë°ì´í„° ë³µêµ¬ ë„êµ¬</h1>
        
        <div class="recovery-steps">
            <h3>ğŸš¨ ë°ì´í„° ë³µêµ¬ ë‹¨ê³„</h3>
            <ol>
                <li><strong>í˜„ì¬ ìƒíƒœ í™•ì¸</strong> â†’ localStorage ë°ì´í„° ê²€ì‚¬</li>
                <li><strong>ë°±ì—… ë°ì´í„° ê²€ìƒ‰</strong> â†’ ê°€ëŠ¥í•œ ë³µêµ¬ ì†ŒìŠ¤ ì°¾ê¸°</li>
                <li><strong>ìˆ˜ë™ ë³µêµ¬</strong> â†’ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ì‹œìŠ¤í…œ í™•ì¸</li>
                <li><strong>ì‹¤ì œ ë°ì´í„° ë³µêµ¬</strong> â†’ ì‹¤ì œ ì£¼ì‹ ì •ë³´ ì…ë ¥</li>
            </ol>
        </div>

        <!-- 1ë‹¨ê³„: í˜„ì¬ ìƒíƒœ í™•ì¸ -->
        <div class="recovery-section">
            <h2>ğŸ” 1ë‹¨ê³„: í˜„ì¬ localStorage ìƒíƒœ í™•ì¸</h2>
            <button class="button" onclick="checkCurrentState()">í˜„ì¬ ìƒíƒœ ê²€ì‚¬</button>
            <button class="button" onclick="searchBackupKeys()">ë°±ì—… í‚¤ ê²€ìƒ‰</button>
            <div id="current-state-result"></div>
        </div>

        <!-- 2ë‹¨ê³„: ë°±ì—… ë°ì´í„° ê²€ìƒ‰ -->
        <div class="recovery-section">
            <h2>ğŸ” 2ë‹¨ê³„: ë°±ì—… ë°ì´í„° ê²€ìƒ‰</h2>
            <button class="button" onclick="deepSearchBackups()">ì „ì²´ localStorage ê²€ìƒ‰</button>
            <button class="button" onclick="exportAllData()">ëª¨ë“  ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <div id="backup-search-result"></div>
        </div>

        <!-- 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë³µêµ¬ -->
        <div class="recovery-section">
            <h2>ğŸ§ª 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ì‹œìŠ¤í…œ í™•ì¸</h2>
            <button class="button success" onclick="createTestStockData()">í…ŒìŠ¤íŠ¸ ì£¼ì‹ ë°ì´í„° ìƒì„±</button>
            <button class="button success" onclick="createTestCashData()">í…ŒìŠ¤íŠ¸ í˜„ê¸ˆ ê³„ì¢Œ ìƒì„±</button>
            <button class="button success" onclick="createFullTestData()">ì „ì²´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±</button>
            <div id="test-recovery-result"></div>
        </div>

        <!-- 4ë‹¨ê³„: ì‹¤ì œ ë°ì´í„° ë³µêµ¬ -->
        <div class="recovery-section">
            <h2>ğŸ“ˆ 4ë‹¨ê³„: ì‹¤ì œ ë°ì´í„° ìˆ˜ë™ ì…ë ¥</h2>
            <div class="info">
                <strong>ğŸ“ ì£¼ì‹ ì •ë³´ë¥¼ ê¸°ì–µë‚˜ëŠ” ëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”:</strong><br>
                - ë³´ìœ  ì£¼ì‹ ì¢…ëª©ëª…, ìˆ˜ëŸ‰, í‰ê· ë‹¨ê°€<br>
                - í˜„ê¸ˆ ê³„ì¢Œ ì”ê³ <br>
                - ê¸°íƒ€ ìì‚° ì •ë³´
            </div>
            <textarea id="manual-stock-input" placeholder="ì˜ˆì‹œ:
AAPL,10,150.00,USD,Apple Inc.
TSLA,5,200.00,USD,Tesla Inc.
005930,100,70000,KRW,ì‚¼ì„±ì „ì" style="width: 100%; height: 120px; margin: 10px 0; padding: 10px;"></textarea>
            <button class="button success" onclick="parseManualStockData()">ì£¼ì‹ ë°ì´í„° íŒŒì‹± ë° ë³µêµ¬</button>
            
            <textarea id="manual-cash-input" placeholder="ì˜ˆì‹œ:
KBêµ­ë¯¼ì€í–‰,5000000,KRW
Chase Checking,2000,USD" style="width: 100%; height: 80px; margin: 10px 0; padding: 10px;"></textarea>
            <button class="button success" onclick="parseManualCashData()">í˜„ê¸ˆ ê³„ì¢Œ ë°ì´í„° ë³µêµ¬</button>
            
            <div id="manual-recovery-result"></div>
        </div>

        <!-- 5ë‹¨ê³„: ë³µêµ¬ ì™„ë£Œ -->
        <div class="recovery-section">
            <h2>âœ… 5ë‹¨ê³„: ë³µêµ¬ ì™„ë£Œ ë° í™•ì¸</h2>
            <button class="button success" onclick="finalCheck()">ë³µêµ¬ ì™„ë£Œ í™•ì¸</button>
            <button class="button" onclick="goToApp()">ì•±ìœ¼ë¡œ ì´ë™</button>
            <button class="button danger" onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ (ì£¼ì˜!)</button>
            <div id="final-result"></div>
        </div>
    </div>

    <script>
        function checkCurrentState() {
            const result = document.getElementById('current-state-result');
            const storeKey = 'financial-dashboard-store';
            const data = localStorage.getItem(storeKey);
            
            let html = '<div class="result"><h3>í˜„ì¬ ìƒíƒœ ê²€ì‚¬ ê²°ê³¼:</h3>';
            
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    const stocks = parsed.state?.stocks || [];
                    const cashAccounts = parsed.state?.cashAccounts || [];
                    
                    html += `<p>âœ… ìŠ¤í† ì–´ ë°œê²¬! ì£¼ì‹: ${stocks.length}ê°œ, ê³„ì¢Œ: ${cashAccounts.length}ê°œ</p>`;
                    
                    if (stocks.length > 0) {
                        html += '<p><strong>ë³´ìœ  ì£¼ì‹:</strong></p><ul>';
                        stocks.forEach(stock => {
                            html += `<li>${stock.symbol} (${stock.name}): ${stock.quantity}ì£¼, í‰ê· ë‹¨ê°€: ${stock.avgPrice}</li>`;
                        });
                        html += '</ul>';
                    } else {
                        html += '<p style="color: orange;">âš ï¸ ì£¼ì‹ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>';
                    }
                    
                } catch (e) {
                    html += `<p style="color: red;">âŒ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜: ${e.message}</p>`;
                }
            } else {
                html += '<p style="color: red;">âŒ financial-dashboard-store í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>';
            }
            
            html += '</div>';
            result.innerHTML = html;
        }

        function searchBackupKeys() {
            const result = document.getElementById('current-state-result');
            let html = '<div class="info"><h3>ë°±ì—… í‚¤ ê²€ìƒ‰ ê²°ê³¼:</h3>';
            
            const allKeys = Object.keys(localStorage);
            const relevantKeys = allKeys.filter(key => 
                key.includes('financial') || 
                key.includes('dashboard') || 
                key.includes('backup') || 
                key.includes('store') ||
                key.includes('stock')
            );
            
            if (relevantKeys.length > 0) {
                html += '<p>âœ… ê´€ë ¨ í‚¤ ë°œê²¬:</p><ul>';
                relevantKeys.forEach(key => {
                    html += `<li><strong>${key}</strong> (í¬ê¸°: ${localStorage.getItem(key)?.length || 0} ë¬¸ì)</li>`;
                });
                html += '</ul>';
            } else {
                html += '<p style="color: red;">âŒ ê´€ë ¨ ë°±ì—… í‚¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            
            html += '</div>';
            result.innerHTML += html;
        }

        function createTestStockData() {
            const testStocks = [
                {
                    id: "test-aapl-1",
                    symbol: "AAPL",
                    name: "Apple Inc.",
                    quantity: 10,
                    avgPrice: 150.00,
                    currentPrice: 175.00,
                    marketValue: 1750.00,
                    currency: "USD"
                },
                {
                    id: "test-tsla-1", 
                    symbol: "TSLA",
                    name: "Tesla Inc.",
                    quantity: 5,
                    avgPrice: 200.00,
                    currentPrice: 220.00,
                    marketValue: 1100.00,
                    currency: "USD"
                },
                {
                    id: "test-samsung-1",
                    symbol: "005930",
                    name: "ì‚¼ì„±ì „ì",
                    quantity: 100,
                    avgPrice: 70000,
                    currentPrice: 75000,
                    marketValue: 7500000,
                    currency: "KRW"
                }
            ];

            // ê¸°ì¡´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë˜ëŠ” ìƒˆë¡œ ìƒì„±
            let existingData;
            try {
                const stored = localStorage.getItem('financial-dashboard-store');
                existingData = stored ? JSON.parse(stored) : { version: 0, state: {} };
            } catch (e) {
                existingData = { version: 0, state: {} };
            }

            // ì£¼ì‹ ë°ì´í„° ì„¤ì •
            existingData.state.stocks = testStocks;
            
            localStorage.setItem('financial-dashboard-store', JSON.stringify(existingData));
            
            document.getElementById('test-recovery-result').innerHTML = 
                '<div class="result">âœ… í…ŒìŠ¤íŠ¸ ì£¼ì‹ ë°ì´í„° ìƒì„± ì™„ë£Œ! (Apple, Tesla, ì‚¼ì„±ì „ì)</div>';
        }

        function createTestCashData() {
            const testCashAccounts = [
                {
                    id: "test-cash-krw-1",
                    name: "KBêµ­ë¯¼ì€í–‰ ì…ì¶œê¸ˆ",
                    balance: 5000000,
                    currency: "KRW"
                },
                {
                    id: "test-cash-usd-1",
                    name: "Chase Checking",
                    balance: 3000,
                    currency: "USD"
                }
            ];

            let existingData;
            try {
                const stored = localStorage.getItem('financial-dashboard-store');
                existingData = stored ? JSON.parse(stored) : { version: 0, state: {} };
            } catch (e) {
                existingData = { version: 0, state: {} };
            }

            existingData.state.cashAccounts = testCashAccounts;
            
            localStorage.setItem('financial-dashboard-store', JSON.stringify(existingData));
            
            document.getElementById('test-recovery-result').innerHTML += 
                '<div class="result">âœ… í…ŒìŠ¤íŠ¸ í˜„ê¸ˆ ê³„ì¢Œ ë°ì´í„° ìƒì„± ì™„ë£Œ! (KRW 500ë§Œì›, USD $3,000)</div>';
        }

        function createFullTestData() {
            const fullTestData = {
                version: 0,
                state: {
                    user: {
                        id: "test-user-1",
                        name: "í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì",
                        email: "test@example.com"
                    },
                    stocks: [
                        {
                            id: "test-aapl-1",
                            symbol: "AAPL",
                            name: "Apple Inc.",
                            quantity: 10,
                            avgPrice: 150.00,
                            currentPrice: 175.00,
                            marketValue: 1750.00,
                            currency: "USD"
                        },
                        {
                            id: "test-tsla-1",
                            symbol: "TSLA", 
                            name: "Tesla Inc.",
                            quantity: 5,
                            avgPrice: 200.00,
                            currentPrice: 220.00,
                            marketValue: 1100.00,
                            currency: "USD"
                        }
                    ],
                    cashAccounts: [
                        {
                            id: "test-cash-krw-1",
                            name: "KBêµ­ë¯¼ì€í–‰ ì…ì¶œê¸ˆ",
                            balance: 5000000,
                            currency: "KRW"
                        },
                        {
                            id: "test-cash-usd-1",
                            name: "Chase Checking",
                            balance: 3000,
                            currency: "USD"
                        }
                    ],
                    transactions: [],
                    stockTransactions: [],
                    dividends: [],
                    savings: [],
                    realEstate: [],
                    loans: [],
                    loanPayments: [],
                    isDarkMode: false,
                    selectedTimeRange: "1Y",
                    sidebarOpen: true,
                    financialData: null,
                    exchangeRate: null
                }
            };

            localStorage.setItem('financial-dashboard-store', JSON.stringify(fullTestData));
            
            document.getElementById('test-recovery-result').innerHTML = 
                '<div class="result">âœ… ì „ì²´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ! ì´ì œ ì•±ì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</div>';
        }

        function parseManualStockData() {
            const input = document.getElementById('manual-stock-input').value.trim();
            if (!input) {
                alert('ì£¼ì‹ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const lines = input.split('\n').filter(line => line.trim());
            const stocks = [];
            let id = 1;

            lines.forEach(line => {
                const parts = line.split(',').map(p => p.trim());
                if (parts.length >= 4) {
                    const [symbol, quantity, avgPrice, currency, name] = parts;
                    stocks.push({
                        id: `manual-${symbol}-${id++}`,
                        symbol: symbol,
                        name: name || symbol,
                        quantity: parseFloat(quantity) || 0,
                        avgPrice: parseFloat(avgPrice) || 0,
                        currentPrice: parseFloat(avgPrice) || 0, // ì¼ë‹¨ í‰ê· ë‹¨ê°€ë¡œ ì„¤ì •
                        marketValue: (parseFloat(quantity) || 0) * (parseFloat(avgPrice) || 0),
                        currency: currency || 'USD'
                    });
                }
            });

            if (stocks.length > 0) {
                let existingData;
                try {
                    const stored = localStorage.getItem('financial-dashboard-store');
                    existingData = stored ? JSON.parse(stored) : { version: 0, state: {} };
                } catch (e) {
                    existingData = { version: 0, state: {} };
                }

                existingData.state.stocks = stocks;
                localStorage.setItem('financial-dashboard-store', JSON.stringify(existingData));
                
                document.getElementById('manual-recovery-result').innerHTML = 
                    `<div class="result">âœ… ${stocks.length}ê°œ ì£¼ì‹ ë°ì´í„°ê°€ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>`;
            } else {
                document.getElementById('manual-recovery-result').innerHTML = 
                    '<div class="error">âŒ ìœ íš¨í•œ ì£¼ì‹ ë°ì´í„°ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        function parseManualCashData() {
            const input = document.getElementById('manual-cash-input').value.trim();
            if (!input) {
                alert('ê³„ì¢Œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const lines = input.split('\n').filter(line => line.trim());
            const cashAccounts = [];
            let id = 1;

            lines.forEach(line => {
                const parts = line.split(',').map(p => p.trim());
                if (parts.length >= 3) {
                    const [name, balance, currency] = parts;
                    cashAccounts.push({
                        id: `manual-cash-${id++}`,
                        name: name,
                        balance: parseFloat(balance) || 0,
                        currency: currency || 'KRW'
                    });
                }
            });

            if (cashAccounts.length > 0) {
                let existingData;
                try {
                    const stored = localStorage.getItem('financial-dashboard-store');
                    existingData = stored ? JSON.parse(stored) : { version: 0, state: {} };
                } catch (e) {
                    existingData = { version: 0, state: {} };
                }

                existingData.state.cashAccounts = cashAccounts;
                localStorage.setItem('financial-dashboard-store', JSON.stringify(existingData));
                
                document.getElementById('manual-recovery-result').innerHTML += 
                    `<div class="result">âœ… ${cashAccounts.length}ê°œ ê³„ì¢Œ ë°ì´í„°ê°€ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>`;
            }
        }

        function finalCheck() {
            const stored = localStorage.getItem('financial-dashboard-store');
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    const stocks = data.state?.stocks || [];
                    const cash = data.state?.cashAccounts || [];
                    
                    let html = '<div class="result"><h3>ë³µêµ¬ ì™„ë£Œ í™•ì¸:</h3>';
                    html += `<p>âœ… ì£¼ì‹ ë°ì´í„°: ${stocks.length}ê°œ</p>`;
                    html += `<p>âœ… í˜„ê¸ˆ ê³„ì¢Œ: ${cash.length}ê°œ</p>`;
                    html += '<p>ğŸ“± ì´ì œ ì•±ì„ ìƒˆë¡œê³ ì¹¨í•´ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</p>';
                    html += '</div>';
                    
                    document.getElementById('final-result').innerHTML = html;
                } catch (e) {
                    document.getElementById('final-result').innerHTML = 
                        '<div class="error">âŒ ë°ì´í„° ê²€ì¦ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</div>';
                }
            } else {
                document.getElementById('final-result').innerHTML = 
                    '<div class="error">âŒ ë³µêµ¬ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        function goToApp() {
            window.open('http://localhost:3000', '_blank');
        }

        function clearAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                localStorage.removeItem('financial-dashboard-store');
                document.getElementById('final-result').innerHTML = 
                    '<div class="error">âš ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ í˜„ì¬ ìƒíƒœ ìë™ í™•ì¸
        window.onload = function() {
            checkCurrentState();
        };
    </script>
</body>
</html>