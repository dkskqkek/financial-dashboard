<!DOCTYPE html>
<html>
<head>
    <title>ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° í™•ì¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .data-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .stock-item { margin: 10px 0; padding: 10px; background-color: #f5f5f5; border-radius: 3px; }
        .domestic-stock { background-color: #e8f5e8; border-left: 4px solid #4CAF50; }
        .foreign-stock { background-color: #e8e8f5; border-left: 4px solid #2196F3; }
        .etf { background-color: #fff3e0; border-left: 4px solid #ff9800; }
        .bond { background-color: #f3e5f5; border-left: 4px solid #9c27b0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë³´ìœ  ì£¼ì‹ ë¶„ë¥˜ í™•ì¸</h1>
        <div id="output"></div>
    </div>

    <script>
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const storageData = localStorage.getItem('financial-dashboard-store');
        let data = null;
        
        if (storageData) {
            try {
                data = JSON.parse(storageData);
                console.log('Full storage data:', data);
            } catch (e) {
                console.error('Error parsing storage data:', e);
            }
        }

        // êµ­ë‚´ì£¼ì‹ ë¶„ë¥˜ ë¡œì§ (Dashboard.tsxì™€ ë™ì¼)
        function classifyStock(stock) {
            const isKoreanListed = stock.exchange === 'KRX' || /^\d{6}$/.test(stock.symbol);
            
            // ETF íŒë³„
            const isEtf = stock.name.includes('ETF') || 
                          stock.name.includes('etf') ||
                          stock.symbol.toUpperCase().includes('ETF') ||
                          stock.name.includes('í€ë“œ') ||
                          stock.name.includes('FUND');
            
            // ì±„ê¶Œ íŒë³„
            const isBond = stock.sector === 'ì±„ê¶Œ' ||
                           stock.name.includes('ì±„ê¶Œ') ||
                           stock.name.includes('Bond') ||
                           stock.name.includes('BOND') ||
                           stock.name.includes('íšŒì‚¬ì±„') ||
                           stock.name.includes('êµ­ê³ ì±„') ||
                           stock.name.includes('TIPS') ||
                           stock.name.includes('Treasury');
            
            if (isBond) {
                return 'bond';
            } else if (isEtf) {
                return isKoreanListed ? 'domesticEtf' : 'foreignEtf';
            } else {
                return isKoreanListed ? 'domesticStock' : 'foreignStock';
            }
        }

        function displayData() {
            const output = document.getElementById('output');
            
            if (!data || !data.state || !data.state.stocks) {
                output.innerHTML = '<div class="data-section"><h2>ë°ì´í„° ì—†ìŒ</h2><p>ì €ì¥ëœ ì£¼ì‹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }

            const stocks = data.state.stocks;
            
            if (stocks.length === 0) {
                output.innerHTML = '<div class="data-section"><h2>ë³´ìœ  ì£¼ì‹ ì—†ìŒ</h2><p>ë“±ë¡ëœ ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }

            // ì£¼ì‹ ë¶„ë¥˜
            const domesticStocks = [];
            const foreignStocks = [];
            const domesticEtfs = [];
            const foreignEtfs = [];
            const bonds = [];

            stocks.forEach(stock => {
                const classification = classifyStock(stock);
                switch (classification) {
                    case 'domesticStock':
                        domesticStocks.push(stock);
                        break;
                    case 'foreignStock':
                        foreignStocks.push(stock);
                        break;
                    case 'domesticEtf':
                        domesticEtfs.push(stock);
                        break;
                    case 'foreignEtf':
                        foreignEtfs.push(stock);
                        break;
                    case 'bond':
                        bonds.push(stock);
                        break;
                }
            });

            let html = `<div class="data-section">
                <h2>ì „ì²´ ë³´ìœ  ì£¼ì‹: ${stocks.length}ê°œ</h2>
            </div>`;

            // êµ­ë‚´ì£¼ì‹ í‘œì‹œ
            if (domesticStocks.length > 0) {
                html += `<div class="data-section">
                    <h2>ğŸ‡°ğŸ‡· êµ­ë‚´ì£¼ì‹ (${domesticStocks.length}ê°œ)</h2>`;
                domesticStocks.forEach(stock => {
                    html += `<div class="stock-item domestic-stock">
                        <strong>${stock.name} (${stock.symbol})</strong><br>
                        ê±°ë˜ì†Œ: ${stock.exchange || 'N/A'} | ì„¹í„°: ${stock.sector || 'N/A'} | í†µí™”: ${stock.currency || 'N/A'}<br>
                        ë³´ìœ ìˆ˜ëŸ‰: ${stock.quantity || 0}ì£¼ | ì‹œì¥ê°€ì¹˜: ${(stock.marketValue || 0).toLocaleString()}ì›
                    </div>`;
                });
                html += '</div>';
            }

            // êµ­ë‚´ ETF í‘œì‹œ
            if (domesticEtfs.length > 0) {
                html += `<div class="data-section">
                    <h2>ğŸ“ˆ êµ­ë‚´ ETF (${domesticEtfs.length}ê°œ)</h2>`;
                domesticEtfs.forEach(stock => {
                    html += `<div class="stock-item etf">
                        <strong>${stock.name} (${stock.symbol})</strong><br>
                        ê±°ë˜ì†Œ: ${stock.exchange || 'N/A'} | ì„¹í„°: ${stock.sector || 'N/A'} | í†µí™”: ${stock.currency || 'N/A'}<br>
                        ë³´ìœ ìˆ˜ëŸ‰: ${stock.quantity || 0}ì£¼ | ì‹œì¥ê°€ì¹˜: ${(stock.marketValue || 0).toLocaleString()}ì›
                    </div>`;
                });
                html += '</div>';
            }

            // í•´ì™¸ì£¼ì‹ í‘œì‹œ
            if (foreignStocks.length > 0) {
                html += `<div class="data-section">
                    <h2>ğŸŒ í•´ì™¸ì£¼ì‹ (${foreignStocks.length}ê°œ)</h2>`;
                foreignStocks.forEach(stock => {
                    html += `<div class="stock-item foreign-stock">
                        <strong>${stock.name} (${stock.symbol})</strong><br>
                        ê±°ë˜ì†Œ: ${stock.exchange || 'N/A'} | ì„¹í„°: ${stock.sector || 'N/A'} | í†µí™”: ${stock.currency || 'N/A'}<br>
                        ë³´ìœ ìˆ˜ëŸ‰: ${stock.quantity || 0}ì£¼ | ì‹œì¥ê°€ì¹˜: ${(stock.marketValue || 0).toLocaleString()}
                    </div>`;
                });
                html += '</div>';
            }

            // í•´ì™¸ ETF í‘œì‹œ
            if (foreignEtfs.length > 0) {
                html += `<div class="data-section">
                    <h2>ğŸŒ í•´ì™¸ ETF (${foreignEtfs.length}ê°œ)</h2>`;
                foreignEtfs.forEach(stock => {
                    html += `<div class="stock-item etf">
                        <strong>${stock.name} (${stock.symbol})</strong><br>
                        ê±°ë˜ì†Œ: ${stock.exchange || 'N/A'} | ì„¹í„°: ${stock.sector || 'N/A'} | í†µí™”: ${stock.currency || 'N/A'}<br>
                        ë³´ìœ ìˆ˜ëŸ‰: ${stock.quantity || 0}ì£¼ | ì‹œì¥ê°€ì¹˜: ${(stock.marketValue || 0).toLocaleString()}
                    </div>`;
                });
                html += '</div>';
            }

            // ì±„ê¶Œ í‘œì‹œ
            if (bonds.length > 0) {
                html += `<div class="data-section">
                    <h2>ğŸ“‹ ì±„ê¶Œ (${bonds.length}ê°œ)</h2>`;
                bonds.forEach(stock => {
                    html += `<div class="stock-item bond">
                        <strong>${stock.name} (${stock.symbol})</strong><br>
                        ê±°ë˜ì†Œ: ${stock.exchange || 'N/A'} | ì„¹í„°: ${stock.sector || 'N/A'} | í†µí™”: ${stock.currency || 'N/A'}<br>
                        ë³´ìœ ìˆ˜ëŸ‰: ${stock.quantity || 0}ì£¼ | ì‹œì¥ê°€ì¹˜: ${(stock.marketValue || 0).toLocaleString()}
                    </div>`;
                });
                html += '</div>';
            }

            // ë¶„ë¥˜ ê¸°ì¤€ ì„¤ëª…
            html += `<div class="data-section">
                <h2>ğŸ“‹ ë¶„ë¥˜ ê¸°ì¤€</h2>
                <p><strong>êµ­ë‚´ì£¼ì‹:</strong> ê±°ë˜ì†Œê°€ 'KRX'ì´ê±°ë‚˜ ì‹¬ë³¼ì´ 6ìë¦¬ ìˆ«ìì¸ ì¢…ëª© ì¤‘, ETFì™€ ì±„ê¶Œì´ ì•„ë‹Œ ì¼ë°˜ ì£¼ì‹</p>
                <p><strong>ì¡°ê±´:</strong></p>
                <ul>
                    <li>ê±°ë˜ì†Œ = 'KRX' ë˜ëŠ” ì‹¬ë³¼ì´ 6ìë¦¬ ìˆ«ì (ì˜ˆ: 005930)</li>
                    <li>ì¢…ëª©ëª…ì— "ETF", "etf", "í€ë“œ", "FUND" í¬í•¨ ì•ˆë¨</li>
                    <li>ì„¹í„°ê°€ "ì±„ê¶Œ"ì´ ì•„ë‹ˆê³ , ì¢…ëª©ëª…ì— ì±„ê¶Œ ê´€ë ¨ í‚¤ì›Œë“œ ì—†ìŒ</li>
                </ul>
            </div>`;

            // ì›ë³¸ ë°ì´í„°ë„ í‘œì‹œ
            html += `<div class="data-section">
                <h2>ğŸ” ì›ë³¸ ë°ì´í„° (JSON)</h2>
                <pre>${JSON.stringify(stocks, null, 2)}</pre>
            </div>`;

            output.innerHTML = html;
        }

        displayData();

        // ì¶”ê°€ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
        const script = document.createElement('script');
        script.src = './extract-domestic-stocks.js';
        document.head.appendChild(script);

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ ì¶”ê°€
        const container = document.querySelector('.container');
        const exportDiv = document.createElement('div');
        exportDiv.innerHTML = `
            <div class="data-section">
                <h2>ğŸ”§ ë°ì´í„° ë¶„ì„ ë„êµ¬</h2>
                <button onclick="runAnalysis()" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer;">
                    ë¶„ì„ ì‹¤í–‰
                </button>
                <button onclick="exportToConsole()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer;">
                    ì½˜ì†” ë‚´ë³´ë‚´ê¸°
                </button>
                <button onclick="copyToClipboard()" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                    ê²°ê³¼ ë³µì‚¬
                </button>
                <div id="analysisResult" style="margin-top: 20px;"></div>
            </div>
        `;
        container.appendChild(exportDiv);

        function runAnalysis() {
            // extract-domestic-stocks.js í•¨ìˆ˜ ì‹¤í–‰
            if (typeof extractDomesticStocks === 'function') {
                const result = extractDomesticStocks();
                document.getElementById('analysisResult').innerHTML = `
                    <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto;">
ì „ì²´ ë³´ìœ  ì¢…ëª©: ${result.totalStocks}ê°œ

ğŸ‡°ğŸ‡· êµ­ë‚´ì£¼ì‹: ${result.domesticStocks.length}ê°œ
${result.domesticStocks.map((s, i) => `${i+1}. ${s.name} (${s.symbol}) - ${s.sector || 'N/A'}`).join('\n')}

ğŸ“ˆ êµ­ë‚´ ETF: ${result.domesticEtfs.length}ê°œ  
${result.domesticEtfs.map((s, i) => `${i+1}. ${s.name} (${s.symbol}) - ${s.sector || 'N/A'}`).join('\n')}

ğŸŒ í•´ì™¸ì£¼ì‹: ${result.foreignStocks.length}ê°œ
${result.foreignStocks.map((s, i) => `${i+1}. ${s.name} (${s.symbol}) - ${s.sector || 'N/A'}`).join('\n')}

ğŸ“Š í•´ì™¸ ETF: ${result.foreignEtfs.length}ê°œ
${result.foreignEtfs.map((s, i) => `${i+1}. ${s.name} (${s.symbol}) - ${s.sector || 'N/A'}`).join('\n')}

ğŸ“‹ ì±„ê¶Œ: ${result.bonds.length}ê°œ
${result.bonds.map((s, i) => `${i+1}. ${s.name} (${s.symbol}) - ${s.sector || 'N/A'}`).join('\n')}
                    </pre>
                `;
            } else {
                document.getElementById('analysisResult').innerHTML = '<p style="color: red;">ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        function exportToConsole() {
            if (typeof extractDomesticStocks === 'function') {
                console.clear();
                extractDomesticStocks();
            }
        }

        function copyToClipboard() {
            const resultElement = document.getElementById('analysisResult').querySelector('pre');
            if (resultElement) {
                navigator.clipboard.writeText(resultElement.textContent).then(() => {
                    alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
            }
        }
    </script>
</body>
</html>